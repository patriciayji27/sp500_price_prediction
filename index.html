<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S&P 500 Direction Predictor â€” Patricia Ji</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Source+Serif+4:ital,opsz,wght@0,8..60,300;0,8..60,400;0,8..60,600;0,8..60,700;1,8..60,400&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CSS VARIABLES & RESET
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg-primary: #0a0f1a;
  --bg-secondary: #111827;
  --bg-card: #161e2e;
  --bg-card-hover: #1c2640;
  --border: #1e293b;
  --border-active: #334155;
  --text-primary: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --accent-teal: #2dd4bf;
  --accent-teal-dim: rgba(45, 212, 191, 0.15);
  --accent-gold: #fbbf24;
  --accent-gold-dim: rgba(251, 191, 36, 0.12);
  --accent-rose: #f43f5e;
  --accent-rose-dim: rgba(244, 63, 94, 0.12);
  --accent-blue: #60a5fa;
  --accent-blue-dim: rgba(96, 165, 250, 0.12);
  --accent-violet: #a78bfa;
  --gradient-hero: linear-gradient(135deg, #0a0f1a 0%, #111827 40%, #0f172a 100%);
  --font-display: 'Source Serif 4', Georgia, serif;
  --font-body: 'DM Sans', system-ui, sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --ease-out: cubic-bezier(0.16, 1, 0.3, 1);
  --ease-spring: cubic-bezier(0.34, 1.56, 0.64, 1);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html {
  scroll-behavior: smooth;
  font-size: 16px;
  -webkit-font-smoothing: antialiased;
}

body {
  font-family: var(--font-body);
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height: 1.7;
  overflow-x: hidden;
}

::selection {
  background: var(--accent-teal);
  color: var(--bg-primary);
}

a { color: var(--accent-teal); text-decoration: none; transition: color 0.2s; }
a:hover { color: #5eead4; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.container {
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 2rem;
}

section {
  padding: 6rem 0;
  position: relative;
}

.section-label {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  font-weight: 500;
  letter-spacing: 0.2em;
  text-transform: uppercase;
  color: var(--accent-teal);
  margin-bottom: 1rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
}

.section-label::before {
  content: '';
  width: 24px;
  height: 1px;
  background: var(--accent-teal);
}

.section-title {
  font-family: var(--font-display);
  font-size: clamp(1.8rem, 4vw, 2.6rem);
  font-weight: 600;
  line-height: 1.2;
  margin-bottom: 1rem;
  color: var(--text-primary);
}

.section-desc {
  font-size: 1.05rem;
  color: var(--text-secondary);
  max-width: 650px;
  margin-bottom: 3rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAV
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
nav {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 100;
  padding: 0 2rem;
  height: 56px;
  display: flex;
  align-items: center;
  background: rgba(10, 15, 26, 0.85);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid var(--border);
  transition: transform 0.3s var(--ease-out);
}

nav .nav-inner {
  max-width: 1100px;
  margin: 0 auto;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

nav .brand {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  font-weight: 500;
  color: var(--text-primary);
  letter-spacing: 0.05em;
}

nav .brand span { color: var(--accent-teal); }

nav .nav-links {
  display: flex;
  gap: 2rem;
  list-style: none;
}

nav .nav-links a {
  font-size: 0.8rem;
  color: var(--text-muted);
  transition: color 0.2s;
  font-weight: 500;
}

nav .nav-links a:hover { color: var(--text-primary); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HERO
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#hero {
  min-height: 100vh;
  display: flex;
  align-items: center;
  background: var(--gradient-hero);
  padding-top: 56px;
  position: relative;
  overflow: hidden;
}

#hero::before {
  content: '';
  position: absolute;
  top: -200px;
  right: -200px;
  width: 600px;
  height: 600px;
  background: radial-gradient(circle, rgba(45, 212, 191, 0.06) 0%, transparent 70%);
  pointer-events: none;
}

.hero-content {
  position: relative;
  z-index: 2;
}

.hero-overline {
  font-family: var(--font-mono);
  font-size: 0.75rem;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  color: var(--accent-teal);
  margin-bottom: 1.5rem;
  opacity: 0;
  animation: fadeUp 0.8s var(--ease-out) 0.2s forwards;
}

.hero-title {
  font-family: var(--font-display);
  font-size: clamp(2.4rem, 6vw, 4rem);
  font-weight: 700;
  line-height: 1.1;
  margin-bottom: 1.5rem;
  opacity: 0;
  animation: fadeUp 0.8s var(--ease-out) 0.4s forwards;
}

.hero-title em {
  font-style: italic;
  color: var(--accent-teal);
}

.hero-subtitle {
  font-size: 1.15rem;
  color: var(--text-secondary);
  max-width: 560px;
  margin-bottom: 2.5rem;
  opacity: 0;
  animation: fadeUp 0.8s var(--ease-out) 0.6s forwards;
}

.hero-stats {
  display: flex;
  gap: 3rem;
  opacity: 0;
  animation: fadeUp 0.8s var(--ease-out) 0.8s forwards;
}

.hero-stat .stat-value {
  font-family: var(--font-mono);
  font-size: 1.6rem;
  font-weight: 500;
  color: var(--accent-teal);
}

.hero-stat .stat-label {
  font-size: 0.78rem;
  color: var(--text-muted);
  margin-top: 0.2rem;
}

.hero-chart-bg {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 40%;
  opacity: 0.12;
  pointer-events: none;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCROLL ANIMATIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.reveal {
  opacity: 0;
  transform: translateY(30px);
  transition: opacity 0.7s var(--ease-out), transform 0.7s var(--ease-out);
}

.reveal.visible {
  opacity: 1;
  transform: translateY(0);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SP500 CHART (section 1)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.chart-container {
  position: relative;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.chart-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1rem;
}

.chart-title-row {
  display: flex;
  align-items: baseline;
  gap: 1rem;
}

.chart-price {
  font-family: var(--font-mono);
  font-size: 1.4rem;
  font-weight: 500;
}

.chart-change {
  font-family: var(--font-mono);
  font-size: 0.85rem;
  padding: 0.15rem 0.5rem;
  border-radius: 4px;
}

.chart-change.up { color: var(--accent-teal); background: var(--accent-teal-dim); }
.chart-change.down { color: var(--accent-rose); background: var(--accent-rose-dim); }

.time-buttons {
  display: flex;
  gap: 0.25rem;
}

.time-btn {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  padding: 0.3rem 0.7rem;
  border: 1px solid var(--border);
  border-radius: 6px;
  background: transparent;
  color: var(--text-muted);
  cursor: pointer;
  transition: all 0.2s;
}

.time-btn:hover { border-color: var(--border-active); color: var(--text-secondary); }
.time-btn.active { background: var(--accent-teal-dim); border-color: var(--accent-teal); color: var(--accent-teal); }

.chart-canvas-wrap {
  position: relative;
  height: 340px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA SOURCES (section 2)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.data-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 1rem;
}

.data-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 1.25rem 1.5rem;
  cursor: pointer;
  transition: all 0.3s var(--ease-out);
  position: relative;
  overflow: hidden;
}

.data-card:hover {
  border-color: var(--border-active);
  background: var(--bg-card-hover);
  transform: translateY(-2px);
}

.data-card.expanded {
  border-color: var(--accent-teal);
  background: var(--bg-card-hover);
}

.data-card-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.5rem;
}

.data-icon {
  width: 36px;
  height: 36px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1rem;
  flex-shrink: 0;
}

.data-card-name {
  font-weight: 600;
  font-size: 0.95rem;
}

.data-card-ticker {
  font-family: var(--font-mono);
  font-size: 0.72rem;
  color: var(--text-muted);
}

.data-card-oneliner {
  font-size: 0.85rem;
  color: var(--text-secondary);
  margin-bottom: 0;
  transition: margin 0.3s;
}

.data-card-detail {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.4s var(--ease-out), opacity 0.3s;
  opacity: 0;
}

.data-card.expanded .data-card-detail {
  max-height: 500px;
  opacity: 1;
  margin-top: 1rem;
}

.data-card.expanded .data-card-oneliner {
  margin-bottom: 0;
}

.detail-section {
  padding-top: 1rem;
  border-top: 1px solid var(--border);
}

.detail-label {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  letter-spacing: 0.1em;
  text-transform: uppercase;
  color: var(--accent-teal);
  margin-bottom: 0.4rem;
}

.detail-text {
  font-size: 0.83rem;
  color: var(--text-secondary);
  line-height: 1.6;
}

.feature-tag {
  display: inline-block;
  font-family: var(--font-mono);
  font-size: 0.68rem;
  padding: 0.2rem 0.5rem;
  border-radius: 4px;
  background: var(--accent-teal-dim);
  color: var(--accent-teal);
  margin: 0.2rem 0.15rem;
}

.arrow-indicator {
  position: absolute;
  top: 1.25rem;
  right: 1.25rem;
  font-size: 0.8rem;
  color: var(--text-muted);
  transition: transform 0.3s var(--ease-out);
}

.data-card.expanded .arrow-indicator {
  transform: rotate(180deg);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FEATURE PIPELINE (section 3)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pipeline-flow {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 3rem;
  overflow-x: auto;
  padding-bottom: 1rem;
}

.pipeline-step {
  flex-shrink: 0;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 1.25rem 1.5rem;
  text-align: center;
  min-width: 170px;
  transition: all 0.3s;
}

.pipeline-step.active {
  border-color: var(--accent-teal);
  box-shadow: 0 0 20px rgba(45, 212, 191, 0.1);
}

.pipeline-step-num {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--accent-teal);
  margin-bottom: 0.3rem;
}

.pipeline-step-title {
  font-weight: 600;
  font-size: 0.9rem;
  margin-bottom: 0.2rem;
}

.pipeline-step-sub {
  font-size: 0.75rem;
  color: var(--text-muted);
}

.pipeline-arrow {
  color: var(--text-muted);
  font-size: 1.2rem;
  flex-shrink: 0;
}

.feature-explorer {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  overflow: hidden;
}

.fe-tabs {
  display: flex;
  border-bottom: 1px solid var(--border);
  overflow-x: auto;
}

.fe-tab {
  font-family: var(--font-mono);
  font-size: 0.72rem;
  padding: 0.9rem 1.2rem;
  color: var(--text-muted);
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
  white-space: nowrap;
  background: none;
  border-top: none;
  border-left: none;
  border-right: none;
}

.fe-tab:hover { color: var(--text-secondary); }
.fe-tab.active { color: var(--accent-teal); border-bottom-color: var(--accent-teal); }

.fe-content {
  padding: 1.5rem;
}

.fe-panel {
  display: none;
}

.fe-panel.active {
  display: block;
  animation: fadeIn 0.3s;
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

.transform-demo {
  display: grid;
  grid-template-columns: 1fr auto 1fr;
  gap: 1rem;
  align-items: center;
  margin-bottom: 1.5rem;
}

.transform-box {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1rem;
}

.transform-box-label {
  font-family: var(--font-mono);
  font-size: 0.65rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.08em;
  margin-bottom: 0.5rem;
}

.transform-values {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  line-height: 1.8;
}

.transform-op {
  font-family: var(--font-mono);
  font-size: 1.2rem;
  color: var(--accent-teal);
  text-align: center;
}

.transform-explanation {
  font-size: 0.88rem;
  color: var(--text-secondary);
  line-height: 1.7;
  padding: 1rem;
  background: var(--bg-secondary);
  border-radius: 8px;
  border-left: 3px solid var(--accent-teal);
}

.transform-explanation code {
  font-family: var(--font-mono);
  font-size: 0.8rem;
  background: rgba(45, 212, 191, 0.1);
  color: var(--accent-teal);
  padding: 0.1rem 0.35rem;
  border-radius: 3px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BEAM SEARCH (section 4)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.beam-viz {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
  margin-bottom: 2rem;
}

.beam-controls {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1.5rem;
}

.beam-btn {
  font-family: var(--font-mono);
  font-size: 0.75rem;
  padding: 0.5rem 1rem;
  border: 1px solid var(--accent-teal);
  border-radius: 6px;
  background: var(--accent-teal-dim);
  color: var(--accent-teal);
  cursor: pointer;
  transition: all 0.2s;
}

.beam-btn:hover { background: rgba(45, 212, 191, 0.25); }
.beam-btn:disabled { opacity: 0.4; cursor: default; }

.beam-round-label {
  font-family: var(--font-mono);
  font-size: 0.78rem;
  color: var(--text-muted);
}

.beam-tree {
  position: relative;
  min-height: 200px;
}

.beam-level {
  display: flex;
  gap: 0.75rem;
  margin-bottom: 1.5rem;
  align-items: flex-start;
  flex-wrap: wrap;
}

.beam-node {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 0.6rem 0.9rem;
  min-width: 180px;
  transition: all 0.4s var(--ease-out);
  opacity: 0;
  transform: translateY(10px);
}

.beam-node.visible {
  opacity: 1;
  transform: translateY(0);
}

.beam-node.best {
  border-color: var(--accent-teal);
  box-shadow: 0 0 12px rgba(45, 212, 191, 0.15);
}

.beam-node.pruned {
  opacity: 0.35;
  border-style: dashed;
}

.beam-node-score {
  font-family: var(--font-mono);
  font-size: 0.9rem;
  font-weight: 500;
  margin-bottom: 0.2rem;
}

.beam-node-info {
  font-size: 0.72rem;
  color: var(--text-muted);
}

.beam-node-dropped {
  font-family: var(--font-mono);
  font-size: 0.68rem;
  color: var(--accent-rose);
  margin-top: 0.2rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESULTS (section 5)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.results-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1.5rem;
  margin-bottom: 2rem;
}

@media (max-width: 768px) {
  .results-grid { grid-template-columns: 1fr; }
}

.result-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
}

.result-card-title {
  font-family: var(--font-mono);
  font-size: 0.72rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-bottom: 1rem;
}

.metric-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.6rem 0;
  border-bottom: 1px solid var(--border);
}

.metric-row:last-child { border-bottom: none; }

.metric-name {
  font-size: 0.88rem;
  color: var(--text-secondary);
}

.metric-value {
  font-family: var(--font-mono);
  font-size: 0.95rem;
  font-weight: 500;
}

.metric-value.highlight { color: var(--accent-teal); }

.fi-bar-container {
  margin-bottom: 0.5rem;
}

.fi-bar-row {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  margin-bottom: 0.4rem;
}

.fi-bar-label {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  width: 160px;
  text-align: right;
  color: var(--text-secondary);
  flex-shrink: 0;
}

.fi-bar-track {
  flex: 1;
  height: 20px;
  background: var(--bg-secondary);
  border-radius: 4px;
  overflow: hidden;
  position: relative;
}

.fi-bar-fill {
  height: 100%;
  border-radius: 4px;
  transition: width 0.8s var(--ease-out);
  position: relative;
}

.fi-bar-fill::after {
  content: attr(data-value);
  position: absolute;
  right: 6px;
  top: 50%;
  transform: translateY(-50%);
  font-family: var(--font-mono);
  font-size: 0.6rem;
  color: var(--bg-primary);
  font-weight: 600;
}

.fi-toggle-type {
  display: flex;
  gap: 0.25rem;
  margin-bottom: 1.25rem;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTERACTIVE FEATURE TOGGLE (section 6)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.toggle-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 0.5rem;
  margin-bottom: 1.5rem;
}

.feature-toggle {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.5rem 0.75rem;
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  user-select: none;
}

.feature-toggle:hover { border-color: var(--border-active); }

.feature-toggle.on {
  border-color: var(--accent-teal);
  background: var(--accent-teal-dim);
}

.feature-toggle .toggle-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: var(--text-muted);
  transition: background 0.2s;
  flex-shrink: 0;
}

.feature-toggle.on .toggle-dot {
  background: var(--accent-teal);
  box-shadow: 0 0 6px rgba(45, 212, 191, 0.4);
}

.feature-toggle .toggle-name {
  font-family: var(--font-mono);
  font-size: 0.7rem;
  color: var(--text-secondary);
}

.feature-toggle.on .toggle-name { color: var(--text-primary); }

.sim-output {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 1.5rem;
}

.sim-meter {
  display: flex;
  align-items: center;
  gap: 1rem;
  margin-bottom: 1rem;
}

.sim-meter-bar {
  flex: 1;
  height: 8px;
  background: var(--bg-secondary);
  border-radius: 4px;
  overflow: hidden;
}

.sim-meter-fill {
  height: 100%;
  border-radius: 4px;
  background: var(--accent-teal);
  transition: width 0.5s var(--ease-out);
}

.sim-auc {
  font-family: var(--font-mono);
  font-size: 1.3rem;
  font-weight: 500;
  color: var(--accent-teal);
  width: 80px;
  text-align: right;
}

.sim-note {
  font-size: 0.82rem;
  color: var(--text-muted);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FOOTER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
footer {
  border-top: 1px solid var(--border);
  padding: 3rem 0;
  text-align: center;
}

footer p {
  font-size: 0.82rem;
  color: var(--text-muted);
  margin-bottom: 0.5rem;
}

footer a { color: var(--accent-teal); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROC CURVE CANVAS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.roc-canvas-wrap {
  height: 300px;
  position: relative;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 640px) {
  .container { padding: 0 1.25rem; }
  section { padding: 4rem 0; }
  .hero-stats { flex-direction: column; gap: 1.5rem; }
  .pipeline-flow { flex-direction: column; align-items: stretch; }
  .pipeline-arrow { transform: rotate(90deg); text-align: center; }
  .transform-demo { grid-template-columns: 1fr; }
  .transform-op { transform: rotate(90deg); }
  nav .nav-links { display: none; }
  .data-grid { grid-template-columns: 1fr; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIVIDER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.section-divider {
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--border), transparent);
}

/* category colors */
.cat-price { background: var(--accent-teal-dim); color: var(--accent-teal); }
.cat-vol { background: var(--accent-rose-dim); color: var(--accent-rose); }
.cat-rates { background: var(--accent-gold-dim); color: var(--accent-gold); }
.cat-fx { background: var(--accent-blue-dim); color: var(--accent-blue); }
.cat-macro { background: rgba(167, 139, 250, 0.12); color: var(--accent-violet); }

.how-arrow {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  margin: 0.75rem 0 0.5rem;
}

.how-arrow::before {
  content: 'â†’';
  color: var(--accent-teal);
  font-family: var(--font-mono);
}

.how-arrow-text {
  font-size: 0.78rem;
  color: var(--text-muted);
  font-style: italic;
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     NAVIGATION
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav>
  <div class="nav-inner">
    <div class="brand">SP500<span>_</span>Predictor</div>
    <ul class="nav-links">
      <li><a href="#market">Market</a></li>
      <li><a href="#data">Data</a></li>
      <li><a href="#features">Features</a></li>
      <li><a href="#selection">Selection</a></li>
      <li><a href="#results">Results</a></li>
      <li><a href="#playground">Playground</a></li>
      <li><a href="https://github.com/patriciayji27/sp500_price_prediction" target="_blank">GitHub â†—</a></li>
    </ul>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HERO
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="hero">
  <div class="container hero-content">
     <div class="hero-overline">Machine Learning Â· Feature Engineering Â· Gradient Boosting
        <span class="byline"> Â· by Patricia Ji</span>
     </div>
    <h1 class="hero-title">Predicting the<br>S&P 500's <em>Next Move</em></h1>
    <p class="hero-subtitle">
      A feature-selection-first approach to next-day direction prediction using
      histogram gradient boosting, beam-search elimination, and 22 engineered signals
      from price, volatility, rates, FX, and macro data.
    </p>
    <div class="hero-stats">
      <div class="hero-stat">
        <div class="stat-value">0.618</div>
        <div class="stat-label">Hold-out AUC</div>
      </div>
      <div class="hero-stat">
        <div class="stat-value">22</div>
        <div class="stat-label">Candidate Features</div>
      </div>
      <div class="hero-stat">
        <div class="stat-value">8 yr / 2 yr</div>
        <div class="stat-label">Train / Test Split</div>
      </div>
      <div class="hero-stat">
        <div class="stat-value">2015â€“2025</div>
        <div class="stat-label">Data Window</div>
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION 1: MARKET OVERVIEW
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="market">
  <div class="container">
    <div class="reveal">
      <div class="section-label">01 â€” The Market</div>
      <h2 class="section-title">S&P 500 Price History</h2>
      <p class="section-desc">
        The task: given today's market close, predict whether the S&P 500 will close
        <strong>higher or lower tomorrow</strong>. Below is the index from 2015 to 2025 â€”
        the window our model trains and tests on.
      </p>
    </div>

    <div class="chart-container reveal">
      <div class="chart-header">
        <div class="chart-title-row">
          <span style="font-weight:600;">S&P 500</span>
          <span class="chart-price" id="chartPrice">â€”</span>
          <span class="chart-change up" id="chartChange">â€”</span>
        </div>
        <div class="time-buttons">
          <button class="time-btn" data-range="1y">1Y</button>
          <button class="time-btn" data-range="3y">3Y</button>
          <button class="time-btn" data-range="5y">5Y</button>
          <button class="time-btn active" data-range="all">All</button>
        </div>
      </div>
      <div class="chart-canvas-wrap">
        <canvas id="sp500Chart"></canvas>
      </div>
    </div>

    <div class="reveal" style="display:flex;gap:2rem;flex-wrap:wrap;">
      <div style="flex:1;min-width:250px;">
        <div style="font-size:0.85rem;color:var(--text-secondary);line-height:1.7;">
          The S&P 500 went up on roughly <strong>53.5%</strong> of trading days in this window â€” a slim
          margin that makes direction prediction genuinely hard. The model's job is to find
          persistent patterns in cross-asset data that tilt those odds, even slightly, in
          our favor.
        </div>
      </div>
      <div style="flex:1;min-width:250px;">
        <div style="font-size:0.85rem;color:var(--text-secondary);line-height:1.7;">
          Key regimes visible in the chart: the pre-COVID bull run, the March 2020 crash
          and V-shaped recovery, the 2022 rate-hike drawdown, and the 2023â€“2024 AI-driven
          rally. Our model must generalize across all of them.
        </div>
      </div>
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION 2: DATA SOURCES
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="data">
  <div class="container">
    <div class="reveal">
      <div class="section-label">02 â€” Raw Data</div>
      <h2 class="section-title">Every Index Tells a Story</h2>
      <p class="section-desc">
        We pull 16 data series from yfinance and FRED. Click any card to see what it
        measures, why it matters for equity prediction, and which features it feeds.
      </p>
    </div>

    <div class="data-grid reveal" id="dataGrid">
      <!-- Cards are rendered by JS -->
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION 3: FEATURE ENGINEERING
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="features">
  <div class="container">
    <div class="reveal">
      <div class="section-label">03 â€” Feature Engineering</div>
      <h2 class="section-title">From Raw Prices to Predictive Signals</h2>
      <p class="section-desc">
        Raw price levels are non-stationary and leak trend. Every feature is a <em>stationary
        transformation</em> â€” returns, z-scores, ratios, or diffs â€” so the model learns
        patterns, not price levels. Explore each category below.
      </p>
    </div>

    <div class="pipeline-flow reveal">
      <div class="pipeline-step active">
        <div class="pipeline-step-num">STEP 1</div>
        <div class="pipeline-step-title">Raw OHLCV</div>
        <div class="pipeline-step-sub">16 series</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-step">
        <div class="pipeline-step-num">STEP 2</div>
        <div class="pipeline-step-title">Stationarize</div>
        <div class="pipeline-step-sub">Returns, diffs, ratios</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-step">
        <div class="pipeline-step-num">STEP 3</div>
        <div class="pipeline-step-title">Engineer</div>
        <div class="pipeline-step-sub">22 candidate features</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-step">
        <div class="pipeline-step-num">STEP 4</div>
        <div class="pipeline-step-title">Select</div>
        <div class="pipeline-step-sub">Beam search elimination</div>
      </div>
      <div class="pipeline-arrow">â†’</div>
      <div class="pipeline-step">
        <div class="pipeline-step-num">STEP 5</div>
        <div class="pipeline-step-title">Predict</div>
        <div class="pipeline-step-sub">â†‘ or â†“ tomorrow</div>
      </div>
    </div>

    <div class="feature-explorer reveal">
      <div class="fe-tabs" id="feTabs">
        <button class="fe-tab active" data-tab="price">Price & Momentum</button>
        <button class="fe-tab" data-tab="vol">Volatility & VIX</button>
        <button class="fe-tab" data-tab="rates">Rates & Curve</button>
        <button class="fe-tab" data-tab="fx">Dollar & FX</button>
        <button class="fe-tab" data-tab="macro">Macro & Liquidity</button>
        <button class="fe-tab" data-tab="cross">Cross-Asset</button>
      </div>

      <div class="fe-content" id="feContent">
        <!-- Panels rendered by JS -->
      </div>
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION 4: FEATURE SELECTION
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="selection">
  <div class="container">
    <div class="reveal">
      <div class="section-label">04 â€” Feature Selection</div>
      <h2 class="section-title">Beam-Search Backward Elimination</h2>
      <p class="section-desc">
        Standard greedy backward elimination commits to a single drop order and can miss
        better subsets. Our beam search keeps the top-k candidate paths alive each round,
        exploring correlated feature interactions that greedy methods miss.
      </p>
    </div>

    <div class="reveal" style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem;">
      <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:1.25rem;">
        <div style="font-family:var(--font-mono);font-size:0.7rem;color:var(--accent-teal);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:0.75rem;">How It Works</div>
        <div style="font-size:0.85rem;color:var(--text-secondary);line-height:1.7;">
          Each round, every feature in the current set is tentatively removed. The resulting
          subsets are scored using the fixed 8-year train / 2-year test split. The top
          <strong>beam_width=10</strong> paths survive to the next round. Search stops when no path
          improves the global best AUC for <strong>2 consecutive rounds</strong>.
        </div>
      </div>
      <div style="background:var(--bg-card);border:1px solid var(--border);border-radius:10px;padding:1.25rem;">
        <div style="font-family:var(--font-mono);font-size:0.7rem;color:var(--accent-gold);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:0.75rem;">Why Beam Search?</div>
        <div style="font-size:0.85rem;color:var(--text-secondary);line-height:1.7;">
          With correlated features (e.g., VIX_Change and VIX_ZScore), removing one may
          temporarily hurt AUC, but removing both may reveal a better subset. Beam search
          can explore "drop A <em>then</em> B" paths that greedy elimination would never reach â€”
          finding the globally superior feature set.
        </div>
      </div>
    </div>

    <div class="beam-viz reveal">
      <div class="beam-controls">
        <button class="beam-btn" id="beamStep">Step Forward â†’</button>
        <button class="beam-btn" id="beamReset" style="background:transparent;border-color:var(--border);color:var(--text-muted);">Reset</button>
        <span class="beam-round-label" id="beamRoundLabel">Round 0 â€” All 22 features (baseline)</span>
      </div>
      <div class="beam-tree" id="beamTree"></div>
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION 5: MODEL RESULTS
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="results">
  <div class="container">
    <div class="reveal">
      <div class="section-label">05 â€” Results</div>
      <h2 class="section-title">Model Performance</h2>
      <p class="section-desc">
        Evaluated on the held-out 2-year test period (Jan 2023 â€“ Jan 2025) using a
        HistGradientBoostingClassifier trained on 2015â€“2023 data.
      </p>
    </div>

    <div class="results-grid reveal">
      <div class="result-card">
        <div class="result-card-title">Hold-out Metrics</div>
        <div class="metric-row">
          <span class="metric-name">AUC (ROC)</span>
          <span class="metric-value highlight">0.6183</span>
        </div>
        <div class="metric-row">
          <span class="metric-name">Accuracy</span>
          <span class="metric-value">57.8%</span>
        </div>
        <div class="metric-row">
          <span class="metric-name">Baseline (coin flip)</span>
          <span class="metric-value" style="color:var(--text-muted);">50.0%</span>
        </div>
        <div class="metric-row">
          <span class="metric-name">Train period</span>
          <span class="metric-value" style="font-size:0.82rem;">2015-01 â†’ 2023-01</span>
        </div>
        <div class="metric-row">
          <span class="metric-name">Test period</span>
          <span class="metric-value" style="font-size:0.82rem;">2023-01 â†’ 2025-01</span>
        </div>
      </div>

      <div class="result-card">
        <div class="result-card-title">ROC Curve</div>
        <div class="roc-canvas-wrap">
          <canvas id="rocChart"></canvas>
        </div>
      </div>
    </div>

    <div class="result-card reveal" style="margin-bottom:2rem;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem;">
        <div class="result-card-title" style="margin-bottom:0;">Feature Importance (Permutation)</div>
        <div class="fi-toggle-type">
          <button class="time-btn active" data-fi="gain" onclick="renderFI('gain')">By Gain</button>
          <button class="time-btn" data-fi="split" onclick="renderFI('split')">By Split Count</button>
        </div>
      </div>
      <div id="fiChart"></div>
    </div>

    <div class="reveal" style="font-size:0.88rem;color:var(--text-secondary);line-height:1.7;max-width:700px;">
      <strong>Interpreting 0.618 AUC:</strong> In equity markets, a 1-day prediction AUC above 0.55
      is considered meaningful. Our 0.618 indicates the model has learned genuine signal â€”
      the distance from the 50-day SMA and 1-day return carry the most predictive weight,
      consistent with mean-reversion and short-term momentum literature.
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECTION 6: PLAYGROUND
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section id="playground">
  <div class="container">
    <div class="reveal">
      <div class="section-label">06 â€” Playground</div>
      <h2 class="section-title">Build Your Own Feature Set</h2>
      <p class="section-desc">
        Toggle features on and off to see how the estimated AUC changes. This simulates
        the beam-search elimination process â€” try to beat the model's selection!
      </p>
    </div>

    <div class="toggle-grid reveal" id="toggleGrid">
      <!-- rendered by JS -->
    </div>

    <div class="sim-output reveal">
      <div style="font-family:var(--font-mono);font-size:0.72rem;color:var(--text-muted);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:1rem;">Estimated Performance</div>
      <div class="sim-meter">
        <div style="font-size:0.82rem;color:var(--text-secondary);width:80px;">AUC</div>
        <div class="sim-meter-bar"><div class="sim-meter-fill" id="simFill" style="width:62%"></div></div>
        <div class="sim-auc" id="simAuc">0.618</div>
      </div>
      <div class="sim-meter" style="margin-bottom:0.5rem;">
        <div style="font-size:0.82rem;color:var(--text-secondary);width:80px;">Features</div>
        <div style="font-family:var(--font-mono);font-size:0.9rem;" id="simCount">22 / 22</div>
      </div>
      <div class="sim-note" id="simNote">
        All features active â€” this is the full candidate set before beam-search elimination.
      </div>
    </div>
  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FOOTER
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<footer>
  <div class="container">
    <p>S&P 500 Next-Day Direction Predictor â€” <a href="https://github.com/patriciayji27" target="_blank">Patricia Ji</a></p>
    <p style="font-size:0.75rem;">Modified from AmplifyME challenge Â· <a href="https://github.com/patriciayji27/sp500_price_prediction" target="_blank">View source on GitHub</a> Â· Not investment advice</p>
  </div>
</footer>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Simulated S&P 500 monthly data 2015-2025 (approximate real values)
const sp500Data = {
  dates: [],
  prices: []
};

// Generate approximate S&P 500 path
(function() {
  const monthlyPrices = [
    2058,2104,2067,2086,2107,2063,2103,1972,1920,2079,2080,2044, // 2015
    1940,1932,2059,2065,2096,2099,2174,2171,2168,2126,2198,2239, // 2016
    2279,2364,2362,2384,2412,2423,2470,2472,2519,2575,2584,2674, // 2017
    2824,2714,2641,2648,2705,2718,2816,2901,2914,2712,2760,2507, // 2018
    2704,2784,2834,2946,2752,2942,2980,2926,2976,3038,3141,3231, // 2019
    3226,2954,2585,2912,3044,3100,3271,3500,3363,3270,3622,3756, // 2020
    3714,3811,3973,4181,4204,4298,4395,4523,4307,4605,4567,4766, // 2021
    4516,4374,4530,4132,4132,3785,4130,4158,3586,3872,4080,3840, // 2022
    4077,3971,4109,4170,4205,4450,4589,4508,4288,4194,4514,4770, // 2023
    4845,5096,5254,5035,5278,5460,5522,5648,5762,5705,6032,5882, // 2024
    5942 // Jan 2025
  ];

  for (let i = 0; i < monthlyPrices.length; i++) {
    const year = 2015 + Math.floor(i / 12);
    const month = (i % 12);
    sp500Data.dates.push(new Date(year, month, 1));
    sp500Data.prices.push(monthlyPrices[i]);
  }
})();

// Data source definitions
const dataSources = [
  {
    name: "S&P 500", ticker: "^GSPC", icon: "ğŸ“ˆ", cat: "cat-price",
    oneliner: "Daily Open, High, Low, Close, Volume â€” the core price series we're predicting.",
    why: "The target variable (next-day direction) comes directly from Close. OHLCV also provides intraday range, body, gap, and volume signals that capture short-term supply/demand dynamics.",
    features: ["SP500_Return_1d","SP500_Dist_SMA_50","SMA_5_21_Cross","SMA_50_200_Cross","SP500_Body","Volume_Ratio","SP500_Gap_1d","SP500_CloseLoc","SP500_RealVol_21d"]
  },
  {
    name: "VIX (Volatility Index)", ticker: "^VIX", icon: "âš¡", cat: "cat-vol",
    oneliner: "The market's 'fear gauge' â€” implied volatility of S&P 500 options over the next 30 days.",
    why: "VIX spikes signal panic selling that often precedes mean-reversion rallies. The VIX level relative to realized volatility (the 'vol risk premium') is one of the best-documented equity predictors in academic finance.",
    features: ["VIX_Change_1d","VIX_Dist_SMA_21","VIX_ZScore_63","Vol_Premium_21d","Vol_Premium_21d_pp","Panic_Reversal_Score"]
  },
  {
    name: "US 10-Year Treasury", ticker: "^TNX", icon: "ğŸ›", cat: "cat-rates",
    oneliner: "Benchmark long-term interest rate â€” the 'risk-free' rate that underpins all asset pricing.",
    why: "Rising 10Y yields increase the discount rate on future earnings, pressuring equity valuations. The 1Yâ€“10Y spread captures yield curve shape â€” a classic recession predictor.",
    features: ["Spread_1Y_10Y","Spread_1Y_10Y_Chg_21d"]
  },
  {
    name: "US 1-Year Treasury", ticker: "via FRED", icon: "ğŸ¦", cat: "cat-rates",
    oneliner: "Short-end rate reflecting near-term Fed policy expectations.",
    why: "Combined with the 10Y to form the yield curve spread. An inverted spread (1Y > 10Y) has preceded every U.S. recession since the 1960s.",
    features: ["Spread_1Y_10Y"]
  },
  {
    name: "Fed Funds Rate", ticker: "FRED: FEDFUNDS", icon: "ğŸ¯", cat: "cat-rates",
    oneliner: "The Federal Reserve's overnight lending rate â€” the primary tool of monetary policy.",
    why: "Rate hikes tighten financial conditions and typically pressure equities. The 21-day change captures the direction of policy, not just its level.",
    features: ["FedFunds_Chg_21d"]
  },
  {
    name: "US Dollar Index (DXY)", ticker: "DX-Y.NYB", icon: "ğŸ’µ", cat: "cat-fx",
    oneliner: "Trade-weighted dollar strength against a basket of 6 major currencies.",
    why: "A strong dollar is a headwind for U.S. multinationals (earnings translation effect) and tightens global financial conditions. Extreme dollar readings tend to mean-revert.",
    features: ["DXY_Return_21d","DXY_ZScore_63"]
  },
  {
    name: "Gold", ticker: "GC=F", icon: "ğŸ¥‡", cat: "cat-fx",
    oneliner: "Safe-haven asset and inflation hedge.",
    why: "Gold relative to copper (the gold/copper ratio) is a powerful risk-off vs. risk-on indicator. Rising gold with falling copper signals defensive positioning.",
    features: []
  },
  {
    name: "Copper", ticker: "HG=F", icon: "ğŸ”¶", cat: "cat-fx",
    oneliner: "'Dr. Copper' â€” industrial metal whose price tracks global economic health.",
    why: "Copper demand is driven by construction and manufacturing. Its price trend is a real-time global growth proxy. Combined with gold for the gold/copper ratio signal.",
    features: []
  },
  {
    name: "WTI Crude Oil", ticker: "CL=F", icon: "ğŸ›¢", cat: "cat-fx",
    oneliner: "Benchmark U.S. crude oil price â€” energy cost for the entire economy.",
    why: "Oil shocks feed into CPI and compress consumer spending. Rapid oil price moves can signal geopolitical risk or demand shifts.",
    features: []
  },
  {
    name: "EUR/USD", ticker: "EURUSD=X", icon: "ğŸ‡ªğŸ‡º", cat: "cat-fx",
    oneliner: "Euro-dollar exchange rate â€” the world's most traded currency pair.",
    why: "Moves inversely with the DXY and reflects relative monetary policy expectations between the Fed and ECB.",
    features: []
  },
  {
    name: "SOX (Semiconductor Index)", ticker: "^SOX", icon: "ğŸ”¬", cat: "cat-price",
    oneliner: "Philadelphia Semiconductor Index â€” tracks 30 major chip companies.",
    why: "Semiconductors are a leading indicator for the tech sector and broader capex cycle. SOX often leads S&P 500 moves by days to weeks.",
    features: []
  },
  {
    name: "Fed Balance Sheet", ticker: "FRED: WALCL", icon: "ğŸ“Š", cat: "cat-macro",
    oneliner: "Total assets held by the Federal Reserve â€” a measure of system-wide liquidity.",
    why: "QE (balance sheet expansion) injects liquidity into markets. QT (shrinking) drains it. The 63-day change captures the current trajectory of Fed liquidity policy.",
    features: ["Fed_BS_Chg_63d"]
  },
  {
    name: "US CPI", ticker: "FRED: CPIAUCSL", icon: "ğŸ·", cat: "cat-macro",
    oneliner: "Consumer Price Index â€” the headline inflation measure.",
    why: "Inflation drives Fed policy expectations. Rising CPI â†’ rate hike expectations â†’ equity pressure. Used as a macro context variable.",
    features: []
  },
  {
    name: "US Unemployment Rate", ticker: "FRED: UNRATE", icon: "ğŸ‘·", cat: "cat-macro",
    oneliner: "Percentage of the labor force that is unemployed.",
    why: "A lagging but important indicator. Rapid unemployment increases signal recession onset and can trigger risk-off moves.",
    features: []
  },
  {
    name: "Consumer Confidence", ticker: "FRED: UMCSENT", icon: "ğŸ˜Š", cat: "cat-macro",
    oneliner: "University of Michigan Consumer Sentiment Index.",
    why: "Consumer confidence leads consumer spending, which drives ~70% of U.S. GDP. Extreme low readings can signal contrarian buying opportunities.",
    features: []
  },
  {
    name: "US Corporate Profits", ticker: "FRED: CP", icon: "ğŸ¢", cat: "cat-macro",
    oneliner: "Quarterly aggregate corporate profits with inventory and capital adjustments.",
    why: "Ultimately, stock prices follow earnings. Quarterly profit trends provide the fundamental backdrop for equity market direction.",
    features: []
  }
];

// Feature definitions for the explorer
const featureCategories = {
  price: {
    title: "Price & Momentum",
    features: [
      { name: "SP500_Return_1d", formula: "(Close[t] - Close[t-1]) / Close[t-1]", rawInput: "Close: 5100, 5080", output: "-0.0039", desc: "Yesterday's return. Short-term momentum â€” the single most directly relevant signal for 1-day prediction. Captures whether the market is trending or due for reversal." },
      { name: "SP500_Dist_SMA_50", formula: "(Close / SMA_50) - 1", rawInput: "Close: 5100, SMA50: 4950", output: "+0.0303", desc: "How far price is from its 50-day moving average. Mean-reversion signal: extreme distance suggests price will revert. This is the #1 feature by importance." },
      { name: "SMA_5_21_Cross", formula: "SMA_5 / SMA_21 - 1", rawInput: "SMA5: 5120, SMA21: 5050", output: "+0.0139", desc: "Short-term vs. medium-term trend. When the 5-day SMA crosses above the 21-day, it signals emerging upward momentum." },
      { name: "SMA_50_200_Cross", formula: "SMA_50 / SMA_200 - 1", rawInput: "SMA50: 5000, SMA200: 4800", output: "+0.0417", desc: "The classic 'golden cross' / 'death cross' indicator, expressed as a continuous spread rather than a binary signal." },
      { name: "SP500_Body", formula: "(Close - Open) / Close", rawInput: "Open: 5090, Close: 5100", output: "+0.0020", desc: "Intraday body direction â€” measures whether buyers or sellers dominated the session." },
      { name: "Volume_Ratio", formula: "Volume / SMA_21(Volume)", rawInput: "Vol: 4.2B, Avg: 3.8B", output: "1.105", desc: "Volume spike detector. Above 1.0 = higher-than-normal activity. Volume confirms price moves â€” high-volume moves are more likely to persist." },
      { name: "SP500_Gap_1d", formula: "(Open[t] - Close[t-1]) / Close[t-1]", rawInput: "Open: 5105, PrevClose: 5100", output: "+0.0010", desc: "Overnight gap. Reflects after-hours news and sentiment. Large gaps often partially fill intraday (gap-fill trading)." },
      { name: "SP500_CloseLoc", formula: "((Close-Low) - (High-Close)) / Range", rawInput: "H:5120 L:5080 C:5110", output: "+0.50", desc: "Where the close sits within the day's range. +1 = close at high (bullish), -1 = close at low (bearish)." }
    ]
  },
  vol: {
    title: "Volatility & VIX",
    features: [
      { name: "SP500_RealVol_21d", formula: "std(returns, 21d) Ã— âˆš252", rawInput: "21d std of returns", output: "14.2%", desc: "Annualized realized volatility over the past 21 trading days. High realized vol means the market is choppy and harder to predict." },
      { name: "VIX_Change_1d", formula: "(VIX[t] - VIX[t-1]) / VIX[t-1]", rawInput: "VIX: 18.5 â†’ 20.2", output: "+0.0919", desc: "Daily VIX change. A spike signals sudden fear increase â€” often a contrarian buy signal when combined with oversold conditions." },
      { name: "VIX_Dist_SMA_21", formula: "(VIX / SMA_21(VIX)) - 1", rawInput: "VIX: 22, SMA21: 18", output: "+0.222", desc: "VIX relative to its own recent average. Extreme readings indicate unusual fear (positive) or complacency (negative)." },
      { name: "VIX_ZScore_63", formula: "(VIX - mean_63) / std_63", rawInput: "VIX:25, Î¼:18, Ïƒ:3", output: "+2.33", desc: "Standardized VIX level over a 63-day window. Z-scores above 2 indicate statistically extreme fear â€” historically a good entry point." },
      { name: "Vol_Premium_21d", formula: "VIX - RealizedVol_21d", rawInput: "VIX:20, RV:14", output: "6.0", desc: "The volatility risk premium. When VIX far exceeds realized vol, options are 'expensive' â€” meaning the market is pricing in more risk than is materializing." },
      { name: "Vol_Premium_21d_pp", formula: "VIX - (100 Ã— RV_21d)", rawInput: "VIX:20, RV:0.14", output: "6.0 pp", desc: "Same as Vol_Premium but in consistent percentage-point units. Ensures correct scaling between VIX (in %) and realized vol (as decimal)." },
      { name: "Panic_Reversal_Score", formula: "max(-Return,0) Ã— max(Î”VIX,0)", rawInput: "Ret:-2%, Î”VIX:+15%", output: "0.003", desc: "Interaction feature: fires only when the market drops AND VIX spikes simultaneously. Designed to catch next-day mean-reversion after panic selling." }
    ]
  },
  rates: {
    title: "Rates & Yield Curve",
    features: [
      { name: "Spread_1Y_10Y", formula: "US_10Y - US_1Y", rawInput: "10Y: 4.25%, 1Y: 4.60%", output: "-0.35%", desc: "The yield curve spread. Negative = inverted curve = classic recession signal. Positive and steepening = economic optimism." },
      { name: "Spread_1Y_10Y_Chg_21d", formula: "Spread[t] - Spread[t-21]", rawInput: "Spread: -0.35 â†’ -0.10", output: "+0.25", desc: "21-day change in the curve spread. Captures whether the curve is steepening (easing expectations) or flattening (tightening). The #3 feature by importance." },
      { name: "FedFunds_Chg_21d", formula: "FedFunds[t] - FedFunds[t-21]", rawInput: "FF: 5.25 â†’ 5.50", output: "+0.25", desc: "21-day change in the effective fed funds rate. Captures the direction of monetary policy â€” tightening (positive) or easing (negative)." }
    ]
  },
  fx: {
    title: "Dollar & FX",
    features: [
      { name: "DXY_Return_21d", formula: "(DXY[t] - DXY[t-21]) / DXY[t-21]", rawInput: "DXY: 103 â†’ 105", output: "+0.0194", desc: "Monthly dollar momentum. A strengthening dollar is typically a headwind for S&P 500 companies with large international revenue exposure." },
      { name: "DXY_ZScore_63", formula: "(DXY - mean_63) / std_63", rawInput: "DXY:106, Î¼:103, Ïƒ:2", output: "+1.50", desc: "Standardized dollar level. Extreme readings (+2 or -2) often precede mean-reversion, which can catalyze equity moves." }
    ]
  },
  macro: {
    title: "Macro & Liquidity",
    features: [
      { name: "Fed_BS_Chg_63d", formula: "(BS[t] - BS[t-63]) / BS[t-63]", rawInput: "BS: $8.9T â†’ $8.8T", output: "-0.011", desc: "Quarterly change in the Fed's total assets. Negative = quantitative tightening (liquidity drain). Positive = QE (liquidity injection). Directly affects market plumbing." }
    ]
  },
  cross: {
    title: "Cross-Asset Correlation",
    features: [
      { name: "SP_VIX_Corr_21d", formula: "corr(SP500_ret, VIX_ret, 21d)", rawInput: "21-day rolling window", output: "-0.82", desc: "Rolling 21-day correlation between S&P 500 and VIX returns. The correlation is normally strongly negative (-0.7 to -0.9). When it weakens (moves toward 0), it signals a regime change where the usual 'fear = sell' dynamic is breaking down." }
    ]
  }
};

// Feature importance data (from the actual model output)
const featureImportance = [
  { name: "SP500_Dist_SMA_50", gain: 15.2, split: 148 },
  { name: "SP500_Return_1d", gain: 9.3, split: 98 },
  { name: "Spread_1Y_10Y_Chg_21d", gain: 8.8, split: 92 },
  { name: "Volume_Ratio", gain: 8.1, split: 88 },
  { name: "SP_VIX_Corr_21d", gain: 6.5, split: 68 },
  { name: "SMA_5_21_Cross", gain: 5.8, split: 62 },
  { name: "VIX_Change_1d", gain: 5.4, split: 58 },
  { name: "VIX_ZScore_63", gain: 5.0, split: 55 },
  { name: "Vol_Premium_21d_pp", gain: 3.8, split: 42 },
  { name: "FedFunds_Chg_21d", gain: 3.5, split: 38 },
  { name: "DXY_Return_21d", gain: 3.2, split: 35 },
  { name: "SP500_Gap_1d", gain: 2.8, split: 30 },
  { name: "DXY_ZScore_63", gain: 2.6, split: 28 },
  { name: "SP500_CloseLoc", gain: 2.2, split: 22 },
  { name: "Fed_BS_Chg_63d", gain: 1.8, split: 18 },
  { name: "Vol_Premium_21d", gain: 1.5, split: 15 },
  { name: "SP500_RealVol_21d", gain: 1.2, split: 10 },
  { name: "VIX_Dist_SMA_21", gain: 0.8, split: 8 },
  { name: "Panic_Reversal_Score", gain: 0.3, split: 3 },
  { name: "Spread_1Y_10Y", gain: 0.0, split: 0 },
  { name: "SMA_50_200_Cross", gain: 1.9, split: 20 },
  { name: "SP500_Body", gain: 1.6, split: 16 },
];

// Beam search simulation data
const beamSimulation = [
  { round: 0, nodes: [{ score: 0.6010, feats: 22, dropped: null, best: true }] },
  { round: 1, nodes: [
    { score: 0.6048, feats: 21, dropped: "Spread_1Y_10Y", best: true },
    { score: 0.6025, feats: 21, dropped: "Panic_Reversal_Score", best: false },
    { score: 0.5998, feats: 21, dropped: "VIX_Dist_SMA_21", best: false, pruned: true },
  ]},
  { round: 2, nodes: [
    { score: 0.6095, feats: 20, dropped: "Panic_Reversal_Score", best: true },
    { score: 0.6070, feats: 20, dropped: "VIX_Dist_SMA_21", best: false },
    { score: 0.6030, feats: 20, dropped: "SP500_RealVol_21d", best: false, pruned: true },
  ]},
  { round: 3, nodes: [
    { score: 0.6130, feats: 19, dropped: "VIX_Dist_SMA_21", best: true },
    { score: 0.6105, feats: 19, dropped: "Vol_Premium_21d", best: false },
    { score: 0.6060, feats: 19, dropped: "SP500_Body", best: false, pruned: true },
  ]},
  { round: 4, nodes: [
    { score: 0.6155, feats: 18, dropped: "Vol_Premium_21d", best: true },
    { score: 0.6125, feats: 18, dropped: "SP500_RealVol_21d", best: false },
  ]},
  { round: 5, nodes: [
    { score: 0.6183, feats: 17, dropped: "SP500_RealVol_21d", best: true },
    { score: 0.6140, feats: 17, dropped: "DXY_ZScore_63", best: false, pruned: true },
  ]},
  { round: 6, nodes: [
    { score: 0.6170, feats: 16, dropped: "SMA_50_200_Cross", best: false },
    { score: 0.6150, feats: 16, dropped: "Fed_BS_Chg_63d", best: false, pruned: true },
  ]},
];


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCROLL REVEAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const observer = new IntersectionObserver((entries) => {
  entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
}, { threshold: 0.1 });
document.querySelectorAll('.reveal').forEach(el => observer.observe(el));


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// S&P 500 CHART
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let sp500ChartInstance = null;

function renderSP500Chart(range) {
  const ctx = document.getElementById('sp500Chart').getContext('2d');
  let startIdx = 0;
  if (range === '1y') startIdx = sp500Data.dates.length - 13;
  else if (range === '3y') startIdx = sp500Data.dates.length - 37;
  else if (range === '5y') startIdx = sp500Data.dates.length - 61;

  const dates = sp500Data.dates.slice(startIdx);
  const prices = sp500Data.prices.slice(startIdx);

  const lastPrice = prices[prices.length - 1];
  const firstPrice = prices[0];
  const change = ((lastPrice - firstPrice) / firstPrice * 100).toFixed(1);

  document.getElementById('chartPrice').textContent = lastPrice.toLocaleString();
  const changeEl = document.getElementById('chartChange');
  changeEl.textContent = (change >= 0 ? '+' : '') + change + '%';
  changeEl.className = 'chart-change ' + (change >= 0 ? 'up' : 'down');

  if (sp500ChartInstance) sp500ChartInstance.destroy();

  const gradient = ctx.createLinearGradient(0, 0, 0, 340);
  gradient.addColorStop(0, 'rgba(45, 212, 191, 0.18)');
  gradient.addColorStop(1, 'rgba(45, 212, 191, 0.0)');

  sp500ChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: dates.map(d => d.toLocaleDateString('en-US', { year:'numeric', month:'short' })),
      datasets: [{
        data: prices,
        borderColor: '#2dd4bf',
        borderWidth: 1.5,
        backgroundColor: gradient,
        fill: true,
        pointRadius: 0,
        pointHoverRadius: 4,
        pointHoverBackgroundColor: '#2dd4bf',
        tension: 0.3,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1e293b',
          titleColor: '#94a3b8',
          bodyColor: '#e2e8f0',
          titleFont: { family: 'JetBrains Mono', size: 11 },
          bodyFont: { family: 'JetBrains Mono', size: 12 },
          padding: 10,
          borderColor: '#334155',
          borderWidth: 1,
          displayColors: false,
          callbacks: {
            label: ctx => 'S&P 500: ' + ctx.parsed.y.toLocaleString()
          }
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(30,41,59,0.5)', drawBorder: false },
          ticks: { color: '#64748b', font: { family: 'JetBrains Mono', size: 10 }, maxRotation: 0, maxTicksLimit: 8 },
          border: { display: false }
        },
        y: {
          grid: { color: 'rgba(30,41,59,0.5)', drawBorder: false },
          ticks: { color: '#64748b', font: { family: 'JetBrains Mono', size: 10 }, callback: v => v.toLocaleString() },
          border: { display: false }
        }
      },
      interaction: { intersect: false, mode: 'index' }
    }
  });
}

document.querySelectorAll('.time-btn[data-range]').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.time-btn[data-range]').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    renderSP500Chart(btn.dataset.range);
  });
});

renderSP500Chart('all');


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA SOURCE CARDS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const dataGrid = document.getElementById('dataGrid');

dataSources.forEach((src, idx) => {
  const card = document.createElement('div');
  card.className = 'data-card';
  card.innerHTML = `
    <span class="arrow-indicator">â–¾</span>
    <div class="data-card-header">
      <div class="data-icon ${src.cat}">${src.icon}</div>
      <div>
        <div class="data-card-name">${src.name}</div>
        <div class="data-card-ticker">${src.ticker}</div>
      </div>
    </div>
    <div class="data-card-oneliner">${src.oneliner}</div>
    <div class="data-card-detail">
      <div class="detail-section">
        <div class="detail-label">Why it matters for prediction</div>
        <div class="detail-text">${src.why}</div>
      </div>
      ${src.features.length > 0 ? `
        <div class="detail-section" style="margin-top:0.75rem;padding-top:0.75rem;">
          <div class="detail-label">Features derived from this data</div>
          <div style="margin-top:0.3rem;">${src.features.map(f => `<span class="feature-tag">${f}</span>`).join('')}</div>
        </div>
      ` : `
        <div class="detail-section" style="margin-top:0.75rem;padding-top:0.75rem;">
          <div class="detail-label">Status</div>
          <div class="detail-text" style="font-style:italic;">Available in the data pipeline but commented out in the current feature set â€” tested during development and didn't improve AUC in beam-search selection.</div>
        </div>
      `}
    </div>
  `;
  card.addEventListener('click', () => {
    const wasExpanded = card.classList.contains('expanded');
    document.querySelectorAll('.data-card.expanded').forEach(c => c.classList.remove('expanded'));
    if (!wasExpanded) card.classList.add('expanded');
  });
  dataGrid.appendChild(card);
});


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEATURE EXPLORER TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFeaturePanel(catKey) {
  const cat = featureCategories[catKey];
  const feContent = document.getElementById('feContent');

  let html = '';
  cat.features.forEach(f => {
    html += `
      <div style="margin-bottom:2rem;">
        <div style="display:flex;align-items:center;gap:0.75rem;margin-bottom:0.75rem;">
          <span class="feature-tag" style="font-size:0.75rem;padding:0.25rem 0.6rem;">${f.name}</span>
          <span style="font-family:var(--font-mono);font-size:0.78rem;color:var(--text-muted);">${f.formula}</span>
        </div>
        <div class="transform-demo">
          <div class="transform-box">
            <div class="transform-box-label">Raw Input</div>
            <div class="transform-values">${f.rawInput}</div>
          </div>
          <div class="transform-op">â†’</div>
          <div class="transform-box">
            <div class="transform-box-label">Feature Value</div>
            <div class="transform-values" style="color:var(--accent-teal);font-weight:500;">${f.output}</div>
          </div>
        </div>
        <div class="transform-explanation">${f.desc}</div>
      </div>
    `;
  });

  feContent.innerHTML = `<div class="fe-panel active">${html}</div>`;
}

document.querySelectorAll('.fe-tab').forEach(tab => {
  tab.addEventListener('click', () => {
    document.querySelectorAll('.fe-tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    renderFeaturePanel(tab.dataset.tab);
  });
});

renderFeaturePanel('price');


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ROC CURVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(function() {
  const ctx = document.getElementById('rocChart').getContext('2d');

  // Approximate ROC points from the actual curve (AUC = 0.6183)
  const fpr = [0,0.01,0.03,0.05,0.08,0.1,0.15,0.2,0.25,0.3,0.35,0.4,0.45,0.5,0.55,0.6,0.65,0.7,0.75,0.8,0.85,0.9,0.95,1.0];
  const tpr = [0,0.04,0.1,0.15,0.22,0.28,0.38,0.45,0.5,0.55,0.59,0.63,0.67,0.7,0.73,0.77,0.8,0.83,0.87,0.9,0.93,0.95,0.98,1.0];

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: fpr,
      datasets: [
        {
          label: 'ROC (AUC = 0.618)',
          data: fpr.map((x, i) => ({ x, y: tpr[i] })),
          borderColor: '#2dd4bf',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.3,
          fill: false,
        },
        {
          label: 'Random (0.50)',
          data: [{ x: 0, y: 0 }, { x: 1, y: 1 }],
          borderColor: '#334155',
          borderWidth: 1,
          borderDash: [5, 5],
          pointRadius: 0,
          fill: false,
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: { color: '#64748b', font: { family: 'JetBrains Mono', size: 10 }, boxWidth: 12 },
          position: 'bottom'
        },
        tooltip: { enabled: false }
      },
      scales: {
        x: {
          type: 'linear',
          title: { display: true, text: 'False Positive Rate', color: '#64748b', font: { family: 'JetBrains Mono', size: 10 } },
          grid: { color: 'rgba(30,41,59,0.5)' },
          ticks: { color: '#64748b', font: { family: 'JetBrains Mono', size: 9 } },
          border: { display: false },
          min: 0, max: 1
        },
        y: {
          type: 'linear',
          title: { display: true, text: 'True Positive Rate', color: '#64748b', font: { family: 'JetBrains Mono', size: 10 } },
          grid: { color: 'rgba(30,41,59,0.5)' },
          ticks: { color: '#64748b', font: { family: 'JetBrains Mono', size: 9 } },
          border: { display: false },
          min: 0, max: 1
        }
      }
    }
  });
})();


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FEATURE IMPORTANCE BARS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderFI(type) {
  document.querySelectorAll('.fi-toggle-type .time-btn').forEach(b => {
    b.classList.toggle('active', b.dataset.fi === type);
  });

  const sorted = [...featureImportance].sort((a, b) => b[type] - a[type]);
  const maxVal = sorted[0][type];

  const container = document.getElementById('fiChart');
  container.innerHTML = sorted.map(f => {
    const pct = maxVal > 0 ? (f[type] / maxVal * 100) : 0;
    const color = f[type] === 0 ? '#334155' : '#2dd4bf';
    const label = type === 'gain' ? f.gain.toFixed(1) + '%' : f.split;
    return `
      <div class="fi-bar-row">
        <div class="fi-bar-label">${f.name}</div>
        <div class="fi-bar-track">
          <div class="fi-bar-fill" style="width:${pct}%;background:${color};" data-value="${label}"></div>
        </div>
      </div>
    `;
  }).join('');

  // Animate bars in
  setTimeout(() => {
    container.querySelectorAll('.fi-bar-fill').forEach(bar => {
      const w = bar.style.width;
      bar.style.width = '0%';
      requestAnimationFrame(() => { bar.style.width = w; });
    });
  }, 50);
}

renderFI('gain');


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BEAM SEARCH VISUALIZATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let beamRound = 0;

function renderBeamRound() {
  const tree = document.getElementById('beamTree');
  const label = document.getElementById('beamRoundLabel');
  const data = beamSimulation[beamRound];

  label.textContent = beamRound === 0
    ? `Round 0 â€” All 22 features (baseline AUC: ${data.nodes[0].score.toFixed(4)})`
    : `Round ${beamRound} â€” Best AUC: ${data.nodes[0].score.toFixed(4)} (${data.nodes[0].feats} features)`;

  // Create level
  const level = document.createElement('div');
  level.className = 'beam-level';
  level.style.opacity = '0';

  if (beamRound > 0) {
    const roundLabel = document.createElement('div');
    roundLabel.style.cssText = 'font-family:var(--font-mono);font-size:0.65rem;color:var(--text-muted);width:50px;flex-shrink:0;text-align:center;padding-top:0.3rem;';
    roundLabel.textContent = `R${beamRound}`;
    level.appendChild(roundLabel);
  }

  data.nodes.forEach((node, i) => {
    const el = document.createElement('div');
    el.className = 'beam-node' + (node.best ? ' best' : '') + (node.pruned ? ' pruned' : '');

    el.innerHTML = `
      <div class="beam-node-score" style="color:${node.best ? 'var(--accent-teal)' : 'var(--text-secondary)'}">
        AUC ${node.score.toFixed(4)}
      </div>
      <div class="beam-node-info">${node.feats} features</div>
      ${node.dropped ? `<div class="beam-node-dropped">âˆ’ ${node.dropped}</div>` : ''}
      ${node.pruned ? '<div style="font-size:0.65rem;color:var(--text-muted);margin-top:0.15rem;font-style:italic;">pruned</div>' : ''}
    `;
    level.appendChild(el);
  });

  tree.appendChild(level);

  // Animate in
  requestAnimationFrame(() => {
    level.style.transition = 'opacity 0.5s';
    level.style.opacity = '1';
    level.querySelectorAll('.beam-node').forEach((n, i) => {
      setTimeout(() => n.classList.add('visible'), i * 100);
    });
  });

  document.getElementById('beamStep').disabled = beamRound >= beamSimulation.length - 1;
}

document.getElementById('beamStep').addEventListener('click', () => {
  if (beamRound < beamSimulation.length - 1) {
    beamRound++;
    renderBeamRound();
  }
});

document.getElementById('beamReset').addEventListener('click', () => {
  beamRound = 0;
  document.getElementById('beamTree').innerHTML = '';
  document.getElementById('beamStep').disabled = false;
  renderBeamRound();
});

renderBeamRound();


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PLAYGROUND: FEATURE TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const allFeatures = featureImportance.map(f => f.name);
const featureState = {};
allFeatures.forEach(f => featureState[f] = true);

// Simplified AUC estimation based on feature importance
function estimateAUC() {
  const activeGains = allFeatures.filter(f => featureState[f]).map(f => {
    const fi = featureImportance.find(x => x.name === f);
    return fi ? fi.gain : 0;
  });

  const totalPossibleGain = featureImportance.reduce((s, f) => s + f.gain, 0);
  const activeGain = activeGains.reduce((s, g) => s + g, 0);

  // Base AUC of 0.50 + contribution from features
  const baseAUC = 0.50;
  const maxLift = 0.118; // ~0.618 - 0.50
  const ratio = totalPossibleGain > 0 ? activeGain / totalPossibleGain : 0;

  // Non-linear: diminishing returns for adding more, penalty for noise features
  const activeCount = allFeatures.filter(f => featureState[f]).length;
  const noisePenalty = activeCount > 17 ? (activeCount - 17) * 0.002 : 0;

  return Math.min(0.65, Math.max(0.50, baseAUC + maxLift * Math.pow(ratio, 0.85) - noisePenalty));
}

function updateSimOutput() {
  const auc = estimateAUC();
  const count = allFeatures.filter(f => featureState[f]).length;

  document.getElementById('simAuc').textContent = auc.toFixed(3);
  document.getElementById('simFill').style.width = ((auc - 0.45) / 0.2 * 100) + '%';
  document.getElementById('simCount').textContent = `${count} / ${allFeatures.length}`;

  const note = document.getElementById('simNote');
  if (count === 0) {
    note.textContent = "No features selected â€” the model has nothing to learn from.";
  } else if (count <= 10) {
    note.textContent = `Lean feature set. Focused on the ${count} most important signals.`;
  } else if (count <= 17) {
    note.textContent = "Near-optimal range. The beam search found the best AUC around 17 features.";
  } else {
    note.textContent = "Full set â€” some noisy features may be hurting generalization.";
  }
}

const toggleGrid = document.getElementById('toggleGrid');
allFeatures.forEach(f => {
  const el = document.createElement('div');
  el.className = 'feature-toggle on';
  el.innerHTML = `<div class="toggle-dot"></div><div class="toggle-name">${f}</div>`;
  el.addEventListener('click', () => {
    featureState[f] = !featureState[f];
    el.classList.toggle('on', featureState[f]);
    updateSimOutput();
  });
  toggleGrid.appendChild(el);
});

updateSimOutput();


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RE-OBSERVE reveals after dynamic content
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
setTimeout(() => {
  document.querySelectorAll('.reveal').forEach(el => observer.observe(el));
}, 100);
</script>

</body>
</html>
